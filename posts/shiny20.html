<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Allan Ritchie - Shiny 2.0 - Shinier Than Ever</title>

  <link rel="canonical" href="https://aritchie.github.io/posts/shiny20">

      <link type="application/rss+xml" rel="alternate" title="Allan Ritchie&#x27;s Blog" href="/Xamarin.rss" />
      <link type="application/rss+xml" rel="alternate" title="Personal Blog of Allan Ritchie" href="/feed.rss" />
      <link type="application/atom+xml" rel="alternate" title="Personal Blog of Allan Ritchie" href="/feed.atom" />
  
  <meta name="application-name" content="Allan Ritchie" />
  <meta name="msapplication-tooltip" content="Allan Ritchie" />
  <meta name="msapplication-starturl" content="/" />

  <meta property="og:title" content="Allan Ritchie - Shiny 2.0 - Shinier Than Ever" />
    <meta property="og:image" content="/images/shiny_logo.png" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://aritchie.github.io/posts/shiny20" />
  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <!-- Bootstrap core CSS -->
  <link href="/vendor/bootstrap/scss/bootstrap.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="/vendor/fontawesome-free/css/brands.min.css" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css' data-no-mirror>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css' data-no-mirror>
  
  <!-- Custom styles for this template -->
  <link href="/scss/clean-blog.css" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.0.0/dist/quicklink.umd.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/themes/prism.css">
  
  


  

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">Allan Ritchie</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/livestream">Live Streams</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/projects">Projects</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/speaking">Speaking</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/posts">Personal Blog of Allan Ritchie</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/tags">Tags</a>
            </li>
</ul>
    </div>
  </div>
</nav>

  <!-- Page Header -->
  <header class="masthead" style="background-image: url(&quot;/images/shiny_logo.png&quot;)">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="post-heading">
          <h1>
            Shiny 2.0 - Shinier Than Ever
          </h1>
              <div class="meta">Published on Friday, June 12, 2020</div>
                <div class="mt-3">
                      <a href="/tags/xamarin" class="badge badge-light"> Xamarin</a>
                      <a href="/tags/oss" class="badge badge-light"> OSS</a>
                      <a href="/tags/shiny" class="badge badge-light"> Shiny</a>
                </div>
        </div>
      </div>
    </div>
  </div>
</header>

  <!-- Main Content -->
  <div class="container"> 
    <div class="row">
      <div id="content" class="col-md-12">  
        <h2 id="tldr">TL;DR</h2>
<p>Version 2.0 is months of work, hundreds of commits, and a lot of discovery around how to improve the end experience.  This release focused on improving the background experience
even more especially on Android.  Android is the source of great pain when it comes to backgrounding and especially around expectations that people
have (for instance, real time background GPS).  As such, Shiny now uses foreground services in most of these places.  As a developer using Shiny, this is completely
transparent change for you unless you want to customize the notification.</p>
<p>Now that I'm done with the boring rant.  Let's talk about some of the cool new features</p>
<ul>
<li><a href="#death-to-boilerplate-code">Boilerplate Code</a></li>
<li><a href="#static-class-generation">Static Class Generation</a></li>
<li><a href="#bluetooth-le">BluetoothLE</a></li>
<li><a href="#push-notifications">Push Notifications</a></li>
<li><a href="#notifications">Local Notifications</a></li>
<li><a href="#whats-next-app-services">What's Next - App Services</a></li>
</ul>
<h2 id="death-to-boilerplate-code">Death to Boilerplate Code</h2>
<p>This was the first source of support pain and issues that users had was usually missed (or wrong) setup.  In 2.0, I set out for how to remove this issue.  With the latest C#/.NET5 release,
source generators were released.  This allows for code to be injected in the places Shiny needed it.  To make things even more convenient for users, I can also wire up all of their
Xamarin Forms, Xamarin Essentials, and other 3rd party source code.</p>
<p>To get an idea, here is a before and after showing both iOS and Android boilerplate</p>
<h3 id="before-no-code-gen">BEFORE (no code gen)</h3>
<pre><code class="language-csharp">// Android App
[global::Android.App.ApplicationAttribute]
public partial class MainApplication : global::Android.App.Application
{
	public MainApplication(IntPtr handle, JniHandleOwnership transfer) : base(handle, transfer) {}

	public override void OnCreate()
	{
		this.ShinyOnCreate(new Samples.SampleStartup());
		global::Xamarin.Essentials.Platform.Init(this);
		base.OnCreate();
	}
}

// Android Activity
public partial class MainActivity
{
	protected override void OnCreate(Bundle savedInstanceState)
	{
		this.ShinyOnCreate();
		TabLayoutResource = Resource.Layout.Tabbar;
		ToolbarResource = Resource.Layout.Toolbar;
		base.OnCreate(savedInstanceState);
		global::Xamarin.Forms.Forms.Init(this, savedInstanceState);
		this.LoadApplication(new Samples.App());
	}

	protected override void OnNewIntent(Intent intent)
	{
		base.OnNewIntent(intent);
		this.ShinyOnNewIntent(intent);
	}

	protected override void OnActivityResult(int requestCode, Result resultCode, Intent data)
	{
		base.OnActivityResult(requestCode, resultCode, data);
		this.ShinyOnActivityResult(requestCode, resultCode, data);
	}

	public override void OnRequestPermissionsResult(int requestCode, string[] permissions, [GeneratedEnum] Permission[] grantResults)
	{
		base.OnRequestPermissionsResult(requestCode, permissions, grantResults);
		this.ShinyOnRequestPermissionsResult(requestCode, permissions, grantResults);
		global::Xamarin.Essentials.Platform.OnRequestPermissionsResult(requestCode, permissions, grantResults);
	}
}

// iOS AppDelegate - all features used
public partial class AppDelegate
{
	partial void OnPreFinishedLaunching(UIApplication app, NSDictionary options);
	partial void OnPostFinishedLaunching(UIApplication app, NSDictionary options);
	public override bool FinishedLaunching(UIApplication app, NSDictionary options)
	{
		this.ShinyFinishedLaunching(new Samples.SampleStartup());
		global::Xamarin.Forms.Forms.Init();
		this.LoadApplication(new Samples.App());
		return base.FinishedLaunching(app, options);
	}
	public override void RegisteredForRemoteNotifications(UIApplication application, NSData deviceToken) =&gt; this.ShinyRegisteredForRemoteNotifications(deviceToken);
	public override void ReceivedRemoteNotification(UIApplication application, NSDictionary userInfo) =&gt; this.ShinyDidReceiveRemoteNotification(userInfo, null);
	public override void DidReceiveRemoteNotification(UIApplication application, NSDictionary userInfo, Action&lt;UIBackgroundFetchResult&gt; completionHandler) =&gt; this.ShinyDidReceiveRemoteNotification(userInfo, completionHandler);
	public override void FailedToRegisterForRemoteNotifications(UIApplication application, NSError error) =&gt; this.ShinyFailedToRegisterForRemoteNotifications(error);
	public override void PerformFetch(UIApplication application, Action&lt;UIBackgroundFetchResult&gt; completionHandler) =&gt; this.ShinyPerformFetch(completionHandler);
	public override void HandleEventsForBackgroundUrl(UIApplication application, string sessionIdentifier, Action completionHandler) =&gt; this.ShinyHandleEventsForBackgroundUrl(sessionIdentifier, completionHandler);
}

</code></pre>
<h3 id="after">AFTER</h3>
<pre><code class="language-csharp">// Android Application - you don't even have to make one
// Android Activity
public partial class MainActivity : Xamarin.Forms.Platform.Android.FormsAppCompatActivity
{
}

// iOS AppDelegate
[Register(&quot;AppDelegate&quot;)]
public partial class AppDelegate : Xamarin.Forms.Platform.iOS.FormsApplicationDelegate
{
}

[assembly: ShinyApplication(
    ShinyStartupTypeName = &quot;Samples.SampleStartup&quot;,
    XamarinFormsAppTypeName = &quot;Samples.App&quot;
)]
</code></pre>
<p>To get this &quot;voodoo&quot; magic.  Simply install the Shiny nuget package.  It's new with 2.0 and add the attribute shown above in &quot;after&quot;.</p>
<h2 id="static-class-generation">Static Class Generation</h2>
<p>There are a lot of users that don't like dependency injection.  I can't see or live in a world without it (for now).  Not all users like dependency injection and I don't want to maintain static classes of everything.
With those thoughts in mind, source generators once again came to the rescue.  All you need to do is install the TODO in the library where you want the classes generated and add the attribute in any file as shown below.
For any Shiny library you have installed in your library, the source generator will create a static equivalent class of the interface.</p>
<pre><code class="language-csharp">[assembly: StaticClasses(&quot;ILikeStatics&quot;)]

// core jobs
ILikeStatics.ShinyJobs.Register(...);

// ble
ILikeStatics.ShinyBleManager.Scan();

</code></pre>
<p>Pretty statics and NO dependency injection to be seen anywhere.</p>
<h2 id="notifications">Notifications</h2>
<p>Notifications had to undergo some changes to make sure things like sounds worked and response actions from notifications were consistent across platforms, thus, channels were
created as to play ball properly with channels on Android and to a far lesser degree, categories on iOS.</p>
<p>Channels are essentially configuration groups.  This provides equivalent functionality to what you find on Android 8+ such as</p>
<ul>
<li>Setting priority</li>
<li>Adding Sounds</li>
<li></li>
</ul>
<p>With iOS, &quot;channels&quot; equate in a way to categories, but apply more to the available actions on a given notification.  With that in mind, I had to bring these two
worlds together for a consistent design between them (oh... and that UWP thing can come along too).  What's better, channel is required on Android - if you don't care
about the additional functionality - omit it and Shiny will default it for you!</p>
<pre><code class="language-cs">var manager = ShinyHost.Resolve&lt;INotificationManager&gt;(); // INJECT THIS
manager.SetChannels(new Channel 
{
	Identifier = &quot;YourChannelName&quot;,
	Description = &quot;This is your channel&quot;,
	Importance = ChannelImportance.Normal // normal+ will add default sounds on android
	CustomSoundPath = &quot;notification.mp3&quot;,
	Actions =
	{
		new ChannelAction
		{
			Identifier = &quot;message&quot;,
			Title = &quot;Leave a Message&quot;,
			ActionType = ChannelActionType.TextReply
		},
		new ChannelAction
		{
			Identifier = &quot;freeticket&quot;,
			Title = &quot;Free Ticket&quot;,
			ActionType = ChannelActionType.Destructive
		}
	}
});

// BONUS - got a resource file that you want to use instead
channel.SetSoundFromEmbeddedResource(this.GetType().Assembly, &quot;Samples.Resources.notification.mp3&quot;);
await manager.CreateChannel(channel);


// now to use it
await manager.Send(
	&quot;WELCOME TO THE CN Tower&quot;,
	&quot;What would you like to do?&quot;,
	&quot;YourChannelName&quot;
)

</code></pre>
<p>Which gives you this!</p>
<p><img src="images/shiny20/notificationactions.gif" alt="Actions1" /></p>
<h2 id="push-notifications">Push Notifications</h2>
<p>Since the mobile era began, I can't count on two hands how many push notification service providers I've seen come and go.  AppCenter, HockeyApp</p>
<p>Currently, Shiny is working with Native, Google Firebase Messaging, and Azure Push Notification Hubs.</p>
<pre><code class="language-csharp">var result = await PushManager.RequestAccess();
if (result.Status == Shiny.AccessState.Available) 
{
    result.RegistrationToken;
}

// foreground
PushManager.WhenReceived().Subscribe(data =&gt; {

});

// background
public class MyPushDelegate : Shiny.Push.IPushDelegate
{

}


// configuring it and switch between them - 1 line of code!

</code></pre>
<h3 id="tag-support">Tag Support</h3>
<p>Tags are a way of telling the push provider (if supported), I want to listen to these &quot;topics&quot;.  This is supported by all of the 3rd party
messaging systems like Firebase &amp; Azure Notifications Hubs.</p>
<pre><code class="language-csharp">``

## Bluetooth LE
I really went through all of the API calls this library had to offer.  

BLE is still firmly (and always will be) rooted in Reactive Extensions, but I wanted to make the APIs easier to consume for all users including myself.

Managed Scans
Scanning was riddled with potential issues
* maintaining a list of unique peripherals while still watching things like the RSSI and 
* synchronizing list updates to your UI
* Removing a device from the list that hasn't been heard in a specific time


Managed Peripheral
The problem with traditional peripheral managed is that with every connection, you had to rescan for all of the services and characteristics you had.  You also had to restore any notifications you had.
This was painful



# What's Next - App Services

Shiny's first purpose in life was to make cross platform device &amp; background services easy, but it was never going to stop there.  I'm now starting to work on services to make scenarios easy.  Here are the first two Shiny modules to follow this plan

## OBD


## Shiny.Locations.Sync 
Sync geofence and GPS events to your backend using a consistent and aggressive practices to ensure this data calls home ASAP

## Shiny.MediaSync
This will scan and upload photos, videos, &amp; audio from your Android &amp; iOS media gallery

## Shiny.TripTracker
Continuing the theme of app services and making the hard tasks easy - trip tracker will record trips for walks, runs, cycling, and automotive.  It uses a combination of GPS and motion activity to record trips.  

## BluetoothLE &quot;Refit&quot; Client
the one mechanism that people seem to keep coming back to me about.  The work has begun.  There will be 2 packages, Shiny.BluetoothLE and Shiny.BluetoothLE.Hosting.  I'm looking to simplify the APIs while still making them as powerful as ever.  There is also a scope of work to have the client work similar to [Refit](https://github.com/reactiveui/refit) and having the GATT host look like SignalR hubs.  This is still in a very early proof-of-concept.

## BluetoothLE SignalR Hosting



# LINKS
* [Samples]()
* [GitHub]()
* [NuGets]()
</code></pre>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    <!-- allan-ritchies-blog.disqus.com -->
    var disqus_shortname = 'allan-ritchies-blog'; // required: replace example with your forum shortname
    var disqus_identifier = 'shiny20';
    var disqus_title = 'Shiny 2.0 - Shinier Than Ever';
    var disqus_url = 'https://aritchie.github.io/posts/shiny20';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>      </div>
    </div>
  </div>

  <hr>

  <!-- Footer -->  
  <div id="footer" class="p-3 text-white" style="background: black">
    <div class="container-xl">
        <div class="row">
            <div class="offset-lg-2 col-12 col-lg-8">
                <div class="text-light text-center font-size-sm">
                    <a target="_NEWWINDOW" href="https://github.com/aritchie" class="text-light pr-2 mr-1"><i class="fab fa-github"></i> GitHub</a>
                    <a target="_NEWWINDOW" href="https://twitter.com/allanritchie911" class="text-light pr-2 mr-1"><i class="fab fa-twitter"></i> Twitter</a>
                    <a target="_NEWWINDOW" href="https://twitch.tv/allancritchie" class="text-light pr-2 mr-1"><i class="fab fa-twitch"></i> Twitch</a>
                    <a target="_NEWWINDOW" class="text-light font-weight-bold" href="https://github.com/sponsors/aritchie"><i class="fa fa-heart"></i> Support</a>
                </div>
                <div class="pt-2 font-size-sm text-muted text-center">
                    © 2020 Allan Ritchie
                </div>
            </div>
        </div>
    </div>
</div>



  <!-- Bootstrap core JavaScript -->
  <script src="/vendor/jquery/jquery.min.js"></script>
  <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134251257-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-134251257-1');
</script>


  

  <!-- Custom scripts for this template -->
  <script src="/js/clean-blog.js"></script>

</body>

</html>
