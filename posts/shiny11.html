<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="The personal blog of Allan Ritchie">

  <title>Allan Ritchie - Shiny 1.1</title>

  <link rel="canonical" href="https://aritchie.github.io/posts/shiny11">

      <link type="application/rss+xml" rel="alternate" title="Allan Ritchie&#x27;s Blog" href="/Xamarin.rss" />
      <link type="application/rss+xml" rel="alternate" href="/feed.rss" />
      <link type="application/atom+xml" rel="alternate" href="/feed.atom" />
  
  <meta name="application-name" content="Allan Ritchie" />
  <meta name="msapplication-tooltip" content="Allan Ritchie" />
  <meta name="msapplication-starturl" content="/" />

  <meta property="og:title" content="Allan Ritchie - Shiny 1.1" />
    <meta property="og:image" content="/images/shiny_logo.png" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://aritchie.github.io/posts/shiny11" />
  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <!-- Bootstrap core CSS -->
  <link href="/vendor/bootstrap/scss/bootstrap.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="/vendor/fontawesome-free/css/brands.min.css" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css' data-no-mirror>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css' data-no-mirror>
  
  <!-- Custom styles for this template -->
  <link href="/scss/clean-blog.css" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.0.0/dist/quicklink.umd.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/themes/prism.css">
  
  


  

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">Allan Ritchie</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/livestream">Live Streams</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/projects">Projects</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/speaking">Speaking</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/posts">Posts</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/tags">Tags</a>
            </li>
</ul>
    </div>
  </div>
</nav>

  <!-- Page Header -->
  <header class="masthead" style="background-image: url(&quot;/images/shiny_logo.png&quot;)">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="post-heading">
          <h1>
            Shiny 1.1
          </h1>
              <div class="meta">Published on Thursday, March 12, 2020</div>
                <div class="mt-3">
                      <a href="/tags/xamarin" class="badge badge-light"> Xamarin</a>
                      <a href="/tags/oss" class="badge badge-light"> OSS</a>
                      <a href="/tags/shiny" class="badge badge-light"> Shiny</a>
                </div>
        </div>
      </div>
    </div>
  </div>
</header>

  <!-- Main Content -->
  <div class="container"> 
    <div class="row">
      <div id="content" class="col-md-12">  
        <p>It's only been a month since the 1.0 release and 1.1 is already here!  1.1 is packed with a ton of updates though.  I've received a ton of feedback over the past few weeks.  One of the big goals I have going forward is to make the boilerplate discovery even easier which hopefully is shown starting with this release.  Make sure to read to the end, the new Push library is pretty epic in my opinion.</p>
<h2 id="easier-boilerplate">Easier Boilerplate</h2>
<p>I found that users were often missing some of the unfortunate boilerplate code that is necessary to integrate with the OS.  With 1.1, I set out to make the discovery a bit easier to work with.</p>
<pre><code class="language-csharp">using Shiny; // important - this will link in the extension methods

// iOS 
public class YourAppDelegate : ApplicationDelegate
{
    public void FinishedLaunching() 
    {
        // 1.0
        iOSShiny.Init(new YourStartup());

        // 1.1
        this.ShinyFinishedLaunching(new YourStartup());
    }

    public override void PerformFetch(UIApplication application, Action&lt;UIBackgroundFetchResult&gt; completionHandler)
    {
        // 1.0
        Shiny.Jobs.JobManager.PerformFetch(completionHandler);

        // 1.1
        this.ShinyPerformFetch(completionHandler);
    }

    public override void HandleEventsForBackgroundUrl(UIApplication application, string sessionIdentifier, Action completionHandler)
    {
        // 1.0
        Shiny.Net.Http.HttpTransferManager.HandleEventsForBackgroundUrl(sessionIdentifier, completionHandler);
        
        // 1.1
        this.ShinyHandleEventsForBackgroundUrl(sessionIdentifier, completionHandler);    
    }
}

// Android Activity
public class MainActivity : FormsAppCompatActivity
{
    protected override void OnCreate(Bundle savedInstanceState)
    {
        TabLayoutResource = Resource.Layout.Tabbar;
        ToolbarResource = Resource.Layout.Toolbar;

        base.OnCreate(savedInstanceState);

        Forms.Init(this, savedInstanceState);
        this.LoadApplication(new App());

        // new with 1.1
        this.ShinyOnCreate();
    }


    protected override void OnNewIntent(Intent intent)
    {
        base.OnNewIntent(intent);

        // new with 1.1
        this.ShinyOnNewIntent(intent);
    }


    public override void OnRequestPermissionsResult(int requestCode, string[] permissions, [GeneratedEnum] Permission[] grantResults)
    {
        base.OnRequestPermissionsResult(requestCode, permissions, grantResults);

        // 1.0
        Shiny.AndroidShinyHost.RequestPermissionsResult(requestCode, permissions, grantResults);

        // 1.1
        this.ShinyRequestPermissionsResult(requestCode, permissions, grantResults);
    }
}

</code></pre>
<h2 id="app-state-delegates">App State Delegates</h2>
<p>Shiny often needs to watch when the app is foregrounding and backgrounding to run stuff internally, so why not expose this functionality to everyone else.<br />
This delegate does behave a tad different than other async delegates in Shiny.  Why?  Because app state changes wait for no one.  You need to do something here quick and synchronously if you want it to get done!</p>
<pre><code class="language-csharp">// to register in your Startup
services.AddAppState&lt;YourAppStateDelegate&gt;();

// and now for the delegate - you can DI as with all other Shiny things
public class AppStateDelegate : IAppStateDelegate
{
    public void OnStart() {}
    public void OnForeground() {}
    public void OnBackground() {}
}
</code></pre>
<h2 id="foreground-on-jobs">Foreground on Jobs</h2>
<p>Building on AppStates, you can configure jobs to run while your app is open.  This is useful if you've got a task that you might want calling home often while you are online.  Perhaps you want to try and synchronize a bunch of offline data while your user is moving around the application?  This is your chance.</p>
<p>To get jobs to run in the foreground, you need to do 2 things</p>
<ol>
<li>In your Shiny startup - add services.UseJobForegroundService(TimeSpan.FromSeconds(30));.  The timespan is how often you want it to poll the jobs to run.</li>
<li>When registering your job, set the JobInfo.RunOnForeground parameter to true;</li>
</ol>
<h2 id="androidx">AndroidX</h2>
<p>AndroidX is now supported in most of the Shiny packages where possible.  Simply upgrade your Android target framework in your head project to use Android 10 and voila, you will automatically have the new AndroidX Shiny libraries.</p>
<p>There is really only 1 significant upgrade other than freeing yourself from those evil support libraries.  I've replaced the default JobScheduler engine with the new shiny WorkManager.  The awesome part, you don't have to change a thing in your job code to get the benefits of this!</p>
<h2 id="other-core-updates">Other Core Updates</h2>
<p>A lot of these services already exist in Xamarin Essentials, but are needed by Shiny internals, so I continue to build on these.  These services often have different twists vs Essentials.  For instance, PowerManager &amp; Connectivity both implement INotifyPropertyChanged very much like an MVVM viewmodel and in fact, they behave exactly like that.  You can use old school .NET events to wire up to PropertyChanged or bring in some RX muscle to watch changes on the properties.</p>
<p>In 1.1,</p>
<p>Connectivity now has the ability to return the current cellular carrier of your device.  PowerManager adds the ability to check if the energy save mode is on.</p>
<pre><code class="language-csharp">ShinyConnectivity.CellularCarrier; // AT&amp;T, etc

ShinyPowerManager.IsEnergySaverEnabled; // Boolean

</code></pre>
<h2 id="notifications">Notifications</h2>
<p>There are several minor, but nice updates to the local notifications library</p>
<ul>
<li>A better way to set sounds either from custom or system</li>
<li>AndroidX upgrade - remove those pesky support libraries!</li>
<li>Android now allows you to use Big text styles and large icons - check the Notification.AndroidOptions</li>
</ul>
<h2 id="location-updates">Location Updates</h2>
<p>Mostly bugfixes for this one with some minor updates</p>
<ul>
<li>We are now checking for the new Android 10 background location permission as necessary</li>
<li>The addition of a pure GPS to Geofence module.  Some customers have stated they don't like the requirement on Google Play Services for many reasons, thus, I wanted to give this option.  This is now also the fallback option (automagically) when Google Play Services is not available!</li>
</ul>
<pre><code class="language-csharp">// in your shiny startup file - this is to force use the GPS geofence module
services.UseGpsDirectGeofencing&lt;YourGeofenceDelegate&gt;();

// otherwise, the regular geofence module will fallback with the usual
services.UseGeofencing&lt;YourGeofenceDelegate&gt;();
</code></pre>
<h2 id="push">Push</h2>
<p>It turns out, a lot of people started to use AppCenter push notifications and like most push centers, it will be disappearing into the wind.  What if you could have a push notification engine that had &quot;one easy abstraction to rule them all&quot;?  This is what I set out to do.</p>
<p>This module is still in beta, but very close to release.</p>
<p>Currently, Shiny supports the default native OS push mechanisms as well as Azure Push Notification Hubs.  Firebase is coming soon!</p>
<pre><code class="language-csharp">// install Shiny.Push.AzureNotifications nuget into your netstandard project
services.UsePushAzureNotificationHubs&lt;PushDelegate&gt;(&quot;Your listener connection string&quot;, &quot;your hub name&quot;);

// don't want any of those provider and like going your own - simply install 
services.UsePushNotifications&lt;PushDelegate&gt;();
</code></pre>
<p>Note that there are several other arguments you can (should) pass to the notification provider such as categories &amp; actions if you use them in your notifications.  Also, you can have Shiny request permission to use push notifications right off the app start.</p>
<p>The push delegate is where you can integrate with data in your backend</p>
<pre><code class="language-csharp">namespace Samples.ShinyDelegates
{
    public class PushDelegate : IPushDelegate
    {
        public Task OnEntry(PushEntryArgs args)
        {
            // the user tapped on a notification
        }

        public Task OnReceived(IDictionary&lt;string, string&gt; data)
        {
            // you received a push, you can work with the payload data here OR maybe go retrieve data from your server
        }

        public Task OnTokenChanged(string token)
        {
            // you should store this and send it off to your server so you send notifications in the future
        }     
    }
}
</code></pre>
<p>The push abstraction has a few &quot;neat&quot; additions.  If you have a UI that listens for silent notifications like I often do, you need an easy way for listening to those notifications.</p>
<pre><code class="language-csharp">// this uses the static host, but you really should DI this!
ShinyPush.WhenReceived().Subscribe(x =&gt; {
    // x is a dictionary that contains the data section of your push notification
})
</code></pre>
<h3 id="closing">Closing</h3>
<p>There's still more - feel free to check out the changelog in the links below!<br />
Do you have any suggestions?  Do you have any device or background mode that is difficult to work with?  Send over a suggestion to <a href="https://github.com/shinyorg/shiny">GitHub</a>!</p>
<p>For those that are watching, I have been actively working on macOS and Tizen implementations.  Still some work to go to get all of those parts stabilized before them make it into Shiny.</p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://github.com/shinyorg/shiny/blob/master/ChangeLog.md">1.1 Change Log</a></li>
<li><a href="/tags/Shiny">All Shiny Articles</a></li>
<li><a href="https://github.com/shinyorg/shinysamples/tree/master/Samples">Samples</a></li>
<li><a href="https://shinylib.net">Documentation</a></li>
<li>Shiny.Core - <a href="https://www.nuget.org/packages/Shiny.Core/"><img src="https://img.shields.io/nuget/v/Shiny.Core.svg?maxAge=2592000" alt="NuGet" /></a></li>
<li>Shiny.Locations - <a href="https://www.nuget.org/packages/Shiny.Locations/"><img src="https://img.shields.io/nuget/v/Shiny.Locations.svg?maxAge=2592000" alt="NuGet" /></a></li>
<li>Shiny.Notifications - <a href="https://www.nuget.org/packages/Shiny.Core/"><img src="https://img.shields.io/nuget/v/Shiny.Core.svg?maxAge=2592000" alt="NuGet" /></a></li>
<li>Shiny.Net.Http - <a href="https://www.nuget.org/packages/Shiny.Net.Http/"><img src="https://img.shields.io/nuget/v/Shiny.Net.Http.svg?maxAge=2592000" alt="NuGet" /></a></li>
<li>Shiny.Push - <a href="https://www.nuget.org/packages/Shiny.Push/"><img src="https://img.shields.io/nuget/v/Shiny.NFC.svg?maxAge=2592000" alt="NuGet" /></a></li>
<li>Shiny.Push.AzureNotificationHubs - <a href="https://www.nuget.org/packages/Shiny.Push.AzureNotificationHubs/"><img src="https://img.shields.io/nuget/v/Shiny.Push.AzureNotificationHubs.svg?maxAge=2592000" alt="NuGet" /></a></li>
</ul>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    <!-- allan-ritchies-blog.disqus.com -->
    var disqus_shortname = 'allan-ritchies-blog'; // required: replace example with your forum shortname
    var disqus_identifier = 'shiny11';
    var disqus_title = 'Shiny 1.1';
    var disqus_url = 'https://aritchie.github.io/posts/shiny11';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>      </div>
    </div>
  </div>

  <hr>

  <!-- Footer -->  
  <div id="footer" class="p-3 text-white" style="background: black">
    <div class="container-xl">
        <div class="row">
            <div class="offset-lg-2 col-12 col-lg-8">
                <div class="text-light text-center font-size-sm">
                    <a target="_NEWWINDOW" href="https://github.com/aritchie" class="text-light pr-2 mr-1"><i class="fab fa-github"></i> GitHub</a>
                    <a target="_NEWWINDOW" href="https://twitter.com/allanritchie911" class="text-light pr-2 mr-1"><i class="fab fa-twitter"></i> Twitter</a>
                    <a target="_NEWWINDOW" href="https://twitch.tv/allancritchie" class="text-light pr-2 mr-1"><i class="fab fa-twitch"></i> Twitch</a>
                    <a target="_NEWWINDOW" class="text-light font-weight-bold" href="https://github.com/sponsors/aritchie"><i class="fa fa-heart"></i> Support</a>
                </div>
                <div class="pt-2 font-size-sm text-muted text-center">
                    © 2020 Allan Ritchie
                </div>
            </div>
        </div>
    </div>
</div>



  <!-- Bootstrap core JavaScript -->
  <script src="/vendor/jquery/jquery.min.js"></script>
  <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134251257-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-134251257-1');
</script>


  

  <!-- Custom scripts for this template -->
  <script src="/js/clean-blog.js"></script>

</body>

</html>
